<script type="text/javascript">
    RED.nodes.registerType('rpc-method', {
        category: 'network',
        color: '#3FADB5',
        defaults: {
            name: { value: "" },
            server: { value: "", type: "rpc-server", required: true },
            methodName: { value: "", required: true }
        },
        inputs: 0,
        outputs: 1,
        icon: "function.svg",
        label: function() {
            return this.name || `method: ${this.methodName}`;
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

<script type="text/html" data-template-name="rpc-method">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-server"></i> RPC Server</label>
        <input type="text" id="node-input-server">
    </div>
    
    <div class="form-row">
        <label for="node-input-methodName"><i class="fa fa-code"></i> Method Name</label>
        <input type="text" id="node-input-methodName" placeholder="myMethod">
    </div>
</script>

<script type="text/html" data-help-name="rpc-method">
    <p>Registers a method handler in an RPC server.</p>
    
    <h3>Configuration</h3>
    <dl class="message-properties">
        <dt>RPC Server <span class="property-type">rpc-server</span></dt>
        <dd>The RPC server node to register this method with</dd>
        
        <dt>Method Name <span class="property-type">string</span></dt>
        <dd>The name of the method to register</dd>
    </dl>
    
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">any</span></dt>
        <dd>The result to return to the caller</dd>
        
        <dt>rpc.id <span class="property-type">number</span></dt>
        <dd>Request ID (automatically passed through)</dd>
        
        <dt class="optional">error <span class="property-type">object</span></dt>
        <dd>Error to return to caller</dd>
    </dl>
    
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">object</span></dt>
        <dd>The method parameters from the RPC request</dd>
        
        <dt>rpc.method <span class="property-type">string</span></dt>
        <dd>The method name that was called</dd>
        
        <dt>rpc.id <span class="property-type">number</span></dt>
        <dd>Request ID to track the response</dd>
    </dl>
    
    <h3>Details</h3>
    <p>This node registers a method in an RPC server. When the method is called,
    it outputs the parameters. Process them in your flow and send the result back
    to this node's input to return it to the caller.</p>
    
    <h3>Example Flow</h3>
    <pre>[RPC Method: "add"]
  ↓
[Function: a + b]
  ↓
[back to RPC Method input]</pre>
</script>
